<!DOCTYPE html>
<html>
<head>
    <title>ESP32 Air-Drum</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background: #1a1a1a; color: white; padding-top: 30px; }
        #status { font-size: 1.2em; margin-bottom: 20px; color: #ff4444; font-weight: bold; }
        button { padding: 15px 40px; font-size: 1.1em; cursor: pointer; background: #00d1ff; border: none; border-radius: 50px; color: black; font-weight: bold; transition: 0.3s; }
        button:hover { background: #00ff88; transform: scale(1.05); }
        .kit-container { display: flex; justify-content: center; gap: 30px; margin-top: 50px; }
        .drum { width: 120px; height: 120px; border: 4px solid #444; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: 0.1s; background: #222; font-weight: bold; }
        .drum.active { transform: scale(1.2); border-color: #00ff88; box-shadow: 0 0 20px #00ff88; background: #333; }
        .label { margin-top: 10px; color: #aaa; text-transform: uppercase; letter-spacing: 2px; font-size: 0.8em; }
    </style>
</head>
<body>
    <h1>ESP32 Air-Drum Dashboard</h1>
    <div id="status">NOT CONNECTED</div>
    <button onclick="connectBLE()">PAIR DRUMSTICK</button>

    <div class="kit-container">
        <div><div id="hihat-vis" class="drum">HH</div><div class="label">Hi-Hat</div></div>
        <div><div id="snare-vis" class="drum">SN</div><div class="label">Snare</div></div>
        <div><div id="kick-vis" class="drum">KK</div><div class="label">Kick</div></div>
    </div>

    <audio id="snareSound" src="snare.wav" preload="auto"></audio>
    <audio id="hihatSound" src="hihat.wav" preload="auto"></audio>
    <audio id="kickSound" src="kick.wav" preload="auto"></audio>

    <script>
        const SERVICE_UUID = "4fafc201-1fb5-459e-8fcc-c5c9c331914b";
        const CHAR_UUID = "beb5483e-36e1-4688-b7f5-ea07361b26a8";

        async function connectBLE() {
            try {
                const device = await navigator.bluetooth.requestDevice({
                    filters: [{ name: 'PocketDrum-DIY' }],
                    optionalServices: [SERVICE_UUID]
                });
                const server = await device.gatt.connect();
                const service = await server.getPrimaryService(SERVICE_UUID);
                const char = await service.getCharacteristic(CHAR_UUID);
                document.getElementById('status').innerText = "READY TO JAM";
                document.getElementById('status').style.color = "#00ff88";
                char.startNotifications();
                char.addEventListener('characteristicvaluechanged', (e) => {
                    let type = new TextDecoder().decode(e.target.value).trim();
                    handleHit(type);
                });
            } catch (err) { alert("Connect failed!"); }
        }

        function handleHit(type) {
            if (type === "SN") playSound('snareSound', 'snare-vis');
            else if (type === "HH") playSound('hihatSound', 'hihat-vis');
            else if (type === "KK") playSound('kickSound', 'kick-vis');
        }

        function playSound(id, visId) {
            const audio = document.getElementById(id);
            const vis = document.getElementById(visId);
            audio.pause(); audio.currentTime = 0; audio.play();
            vis.classList.add('active');
            setTimeout(() => vis.classList.remove('active'), 80);
        }
    </script>
</body>
</html>